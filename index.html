<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Product Review — Fil's Birthday Card</title>
  <style>
    :root{--accent:#0b84ff;--muted:#6b7280;--bg:#f6f7fb;--card:#fff}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:#111;background:var(--bg)}
    .wrap{max-width:1000px;margin:32px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    .logo{width:72px;height:72px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#7cc3ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:22px}
    h1{margin:0;font-size:22px}
    .meta{color:var(--muted);font-size:14px}
    .controls{margin-top:18px;display:flex;gap:12px;flex-wrap:wrap}
    button{background:var(--accent);border:0;color:#fff;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(11,132,255,.12)}
    .summary{margin-top:20px;display:flex;gap:20px;align-items:center}
    .rating-big{font-size:36px;font-weight:700}
    .rating-sub{color:var(--muted)}
    .reviews{margin-top:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:16px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(18,23,35,0.05)}
    .review-header{display:flex;align-items:center;gap:12px}
    .avatar{width:44px;height:44px;border-radius:50%;background:#eee;display:inline-flex;align-items:center;justify-content:center;font-weight:700;color:#555}
    .name{font-weight:700}
    .stars{color:#ffb020}
    .title{margin:8px 0;font-weight:600}
    .body{color:#222;white-space:pre-wrap}
    .empty{color:var(--muted);text-align:center;padding:36px;border-radius:12px;background:linear-gradient(180deg,#fff0,#0000)}
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;z-index:50}
    .modal{background:var(--card);padding:18px;border-radius:12px;max-width:640px;width:92%;box-shadow:0 8px 40px rgba(2,6,23,.25)}
    .form-row{display:flex;gap:10px;margin-bottom:10px}
    .form-row input[type=text],textarea,select{flex:1;padding:10px;border-radius:8px;border:1px solid #e6e9ef}
    textarea{min-height:110px;resize:vertical}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    .small{font-size:13px;color:var(--muted)}
    footer.note{margin-top:22px;color:var(--muted);font-size:13px}
    @media (max-width:560px){header{gap:10px}.logo{width:56px;height:56px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">FK</div>
      <div>
        <h1>Happy Birthday Fil! — Product Review card</h1>
        <div class="meta">A playful product-review style birthday card page — leave a review as your birthday message for the fantastic Fil!</div>
      </div>
    </header>

    <div class="controls">
      <button id="addBtn">+ Add a review</button>
      <button id="exportBtn" class="ghost">Export reviews (JSON)</button>
      <button id="importBtn" class="ghost">Import reviews</button>
      <button id="shareBtn" class="ghost">Submit</button>
      <input id="fileInput" type="file" accept="application/json" style="display:none" />
    </div>

    <section class="summary card" style="margin-top:18px;display:flex;align-items:center;justify-content:space-between">
      <div style="display:flex;gap:18px;align-items:center">
        <div>
          <div class="rating-big" id="avgRating">—</div>
          <div class="rating-sub">Average rating</div>
        </div>
        <div>
          <div id="countReviews" style="font-weight:700">0 reviews</div>
          <div class="small">Click "Add a review" to leave a birthday message.</div>
        </div>
      </div>
      <div style="text-align:right;color:var(--muted)">
        <div style="font-weight:700">Birthday boy: <span id="celebrantName">Filip Kadinski</span></div>
        <div class="small">Made with ❤️ — Organiser can export and merge reviews.</div>
      </div>
    </section>

    <div id="reviewsArea" class="reviews" style="margin-top:14px">
      <div class="empty card">No reviews yet — be the first to leave a birthday message!</div>
    </div>

    <footer class="note">
      <strong>How to add your birthday review:</strong><br>
      <ol>
      <li>Click <strong>“Add a review”</strong> and write your birthday message</li>
      <li>Click <strong>“Submit”</strong></li>
      <li>A link will be copied. <strong>Send the link back to Karyl</strong> (digital equivalent of passing the card around).</li>
      </ol>
      Contact Karyl if you run into any problems with this!
    </footer>
  </div>

  <!-- Modal -->
  <div id="modal" style="display:none" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <h3 id="modalTitle">Write a review</h3>
      <div style="margin-top:10px">
        <div class="form-row">
          <div style="flex:0 0 120px">
            <label for="rating">Rating</label>
            <select id="rating" aria-label="rating">
              <option value="5">★★★★★ — 5</option>
              <option value="4">★★★★ — 4</option>
              <option value="3">★★★ — 3</option>
              <option value="2">★★ — 2</option>
              <option value="1">★ — 1</option>
            </select>
          </div>
          <div style="flex:1">
            <label for="name">Your name</label>
            <input id="name" type="text" placeholder="e.g. Sam" />
          </div>
        </div>

        <div style="margin-bottom:10px">
          <label for="title">Headline (short)</label>
          <input id="title" type="text" placeholder="e.g. Legendary colleague" />
        </div>

        <div>
          <label for="message">Message</label>
          <textarea id="message" placeholder="Write your birthday message as a review... (be playful!)"></textarea>
        </div>

        <div style="display:flex;gap:10px;margin-top:12px;justify-content:flex-end">
          <button id="saveReview">Save review</button>
          <button id="cancelModal" class="ghost">Cancel</button>
        </div>

      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'br_reviews_v1';
    // Start with an empty list:
    localStorage.removeItem(STORAGE_KEY);

    function uid(){return Math.random().toString(36).slice(2,9)}
    function loadReviews(){try{const raw=localStorage.getItem(STORAGE_KEY);return raw?JSON.parse(raw):[]}catch(e){return []}}
    function saveReviews(r){localStorage.setItem(STORAGE_KEY,JSON.stringify(r));renderReviews()}

    function renderReviews(){
      const reviews=loadReviews();
      const area=document.getElementById('reviewsArea');
      area.innerHTML='';
      if(!reviews.length){
        area.innerHTML='<div class="empty card">No reviews yet — be the first to leave a birthday message!</div>';
        document.getElementById('avgRating').textContent='—';
        document.getElementById('countReviews').textContent='0 reviews';
        return;
      }
      const avg=(reviews.reduce((s,r)=>s+r.rating,0)/reviews.length)||0;
      document.getElementById('avgRating').textContent=avg.toFixed(1);
      document.getElementById('countReviews').textContent=reviews.length+(reviews.length===1?' review':' reviews');
      reviews.slice().reverse().forEach(r=>{
        const div=document.createElement('div');div.className='card';
        div.innerHTML=`
          <div class="review-header">
            <div class="avatar">${escapeHtml(initials(r.name||'Anon'))}</div>
            <div>
              <div class="name">${escapeHtml(r.name||'Anon')}</div>
              <div class="small">${stars(r.rating)} · ${new Date(r.date).toLocaleString()}</div>
            </div>
          </div>
          <div class="title">${escapeHtml(r.title||'')}</div>
          <div class="body">${escapeHtml(r.message||'')}</div>`;
        area.appendChild(div);
      });
    }

    function initials(n){return n.split(' ').map(s=>s[0]||'').slice(0,2).join('').toUpperCase()}
    function stars(n){return '★'.repeat(n)+'☆'.repeat(5-n)}
    function escapeHtml(s){if(!s)return'';return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')}

    const modal=document.getElementById('modal');
    document.getElementById('addBtn').addEventListener('click',()=>openModal());
    document.getElementById('cancelModal').addEventListener('click',closeModal);
    document.getElementById('saveReview').addEventListener('click',()=>{
      const rating=parseInt(document.getElementById('rating').value,10);
      const name=document.getElementById('name').value.trim()||'Anon';
      const title=document.getElementById('title').value.trim();
      const message=document.getElementById('message').value.trim();
      if(!message){alert('Please write a message');return}
      const reviews=loadReviews();
      reviews.push({id:uid(),rating,name,title,message,date:new Date().toISOString()});
      saveReviews(reviews);
      closeModal();clearForm();
    });

    function openModal(){modal.style.display='flex';modal.setAttribute('aria-hidden','false');document.getElementById('name').focus();}
    function closeModal(){modal.style.display='none';modal.setAttribute('aria-hidden','true');}
    function clearForm(){document.getElementById('rating').value='5';document.getElementById('name').value='';document.getElementById('title').value='';document.getElementById('message').value='';}

    document.getElementById('exportBtn').addEventListener('click',()=>{
      const data=loadReviews();
      const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');a.href=url;a.download='birthday-reviews.json';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
    });

    document.getElementById('importBtn').addEventListener('click',()=>document.getElementById('fileInput').click());
    document.getElementById('fileInput').addEventListener('change',async e=>{
      const f=e.target.files[0];if(!f)return;
      try{
        const text=await f.text();const imported=JSON.parse(text);
        if(!Array.isArray(imported))throw new Error('Invalid file format');
        const existing=loadReviews();
        const merged=existing.concat(imported.map(it=>({id:it.id||uid(),rating:it.rating||5,name:it.name||'Anon',title:it.title||'',message:it.message||'',date:it.date||new Date().toISOString()})));
        saveReviews(merged);
        alert('Imported '+imported.length+' reviews (merged).');
      }catch(err){alert('Import failed: '+err.message)}
      e.target.value='';
    });

    function encodeReviewsToHash(){
      const data=loadReviews();
      try{
        const s=btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        location.hash='reviews='+s;
        return location.href;
      }catch(e){alert('Could not create link (data too large). Try Export instead.');return null}
    }
    function loadFromHash(){
      const h=location.hash.replace(/^#/,'');if(!h)return false;
      const parts=new URLSearchParams(h.replace(/&/g,'&'));
      if(!parts.has('reviews'))return false;
      try{
        const s=parts.get('reviews');
        const json=decodeURIComponent(escape(atob(s)));
        const arr=JSON.parse(json);
        if(Array.isArray(arr)){saveReviews(arr);return true}
      }catch(e){console.error(e)}
      return false;
    }

    document.getElementById('shareBtn').addEventListener('click',()=>{
      const link=encodeReviewsToHash();
      if(link){navigator.clipboard?.writeText(link).then(()=>alert('Shareable link copied to clipboard!'),()=>alert('Link generated — copy the URL from your browser.'))}
    });

    window.addEventListener('load',()=>{
      loadFromHash();
      renderReviews();
    });
  </script>
</body>
</html>
